<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Work Order EM</title>
  <style>
    body { font-family: Arial; font-size: 12px; margin: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #999; padding: 4px; text-align: left; }

    /* Equipment & Model lebih kecil */
    th:nth-child(1), td:nth-child(1),  
    th:nth-child(2), td:nth-child(2) { width: 80px; max-width: 80px; }

    /* Perlebar kolom Component */
    th:nth-child(3), td:nth-child(3) { width: 250px; max-width: 250px; word-wrap: break-word; }

    /* Kolom numerik (Freq → Life %) */
    th:nth-child(4), td:nth-child(4),
    th:nth-child(5), td:nth-child(5),
    th:nth-child(6), td:nth-child(6),
    th:nth-child(7), td:nth-child(7),
    th:nth-child(8), td:nth-child(8),
    th:nth-child(9), td:nth-child(9),
    th:nth-child(10), td:nth-child(10) {
      width: 80px; max-width: 80px; text-align: right;
    }

    /* Perlebar kolom Remarks */
    th:nth-child(11), td:nth-child(11) {
      width: 200px; max-width: 200px; word-wrap: break-word;
    }

    /* Action lebih kecil */
    th:nth-child(12), td:nth-child(12) {
      width: 100px; max-width: 100px; text-align: center;
    }

    .pagination { margin-top: 10px; }
    .pagination button { margin: 2px; }
  </style>
</head>
<body>
  <h2>Work Order EM</h2>
  <button onclick="loadJSON()">📂 Load JSON</button>
  <input type="text" id="searchBox" placeholder="Cari data..." oninput="applySearch()">

  <table id="component-table">
    <thead>
      <tr>
        <th>Equipment</th>
        <th>Model</th>
        <th>Component</th>
        <th>Freq</th>
        <th>Cost</th>
        <th>Change Out</th>
        <th>Current SMU</th>
        <th>Next Change</th>
        <th>Life</th>
        <th>Life %</th>
        <th>Remarks</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="pagination" id="pagination"></div>

<script>
let allData = [];      // semua data dari JSON
let filteredData = []; // hasil filter/search
let currentPage = 1;
const rowsPerPage = 100;

// 📂 Load JSON
function loadJSON() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'application/json';

  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const parsed = JSON.parse(ev.target.result);
        allData = parsed.component || parsed; 
        filteredData = allData; 
        currentPage = 1;
        renderTable();
      } catch (err) {
        alert("File JSON tidak valid: " + err.message);
      }
    };
    reader.readAsText(file);
  };
  input.click();
}

// 🔎 Search filter
function applySearch() {
  const q = document.getElementById('searchBox').value.toLowerCase();
  filteredData = allData.filter(obj =>
    Object.values(obj).some(val =>
      String(val).toLowerCase().includes(q)
    )
  );
  currentPage = 1;
  renderTable();
}

// 🖨 Render Table + Pagination
function renderTable() {
  const tbody = document.querySelector("#component-table tbody");
  tbody.innerHTML = "";

  const start = (currentPage - 1) * rowsPerPage;
  const pageData = filteredData.slice(start, start + rowsPerPage);

  let html = "";
  pageData.forEach(obj => {
    html += `
      <tr>
        <td>${obj["Equipment"] || ""}</td>
        <td>${obj["Model"] || ""}</td>
        <td>${obj["Component"] || ""}</td>
        <td class="num">${obj["Freq"] || ""}</td>
        <td class="num">${obj["Cost"] || ""}</td>
        <td class="num">${obj["Change Out"] || ""}</td>
        <td class="num">${obj["Current SMU"] || ""}</td>
        <td class="num">${obj["Next Change"] || ""}</td>
        <td class="num">${obj["Life"] || ""}</td>
        <td class="life-perc">${obj["Life %"] || "0%"}</td>
        <td>${obj["Remarks"] || ""}</td>
        <td>
          <button onclick="editRow(this)">Edit</button>
          <button onclick="saveRow(this)">Save</button>
          <button onclick="deleteRow(this)">Delete</button>
        </td>
      </tr>`;
  });

  tbody.innerHTML = html;
  renderPagination();
}

// 📄 Render pagination
function renderPagination() {
  const totalPages = Math.ceil(filteredData.length / rowsPerPage);
  const container = document.getElementById("pagination");
  container.innerHTML = "";

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    if (i === currentPage) btn.disabled = true;
    btn.onclick = () => { currentPage = i; renderTable(); };
    container.appendChild(btn);
  }
}

// ✏ Edit / Save / Delete row
function editRow(btn) {
  const row = btn.closest("tr");
  [...row.cells].forEach((cell, i) => {
    if (i < 11) {
      const val = cell.innerText;
      cell.innerHTML = <input value="${val}">;
    }
  });
}

function saveRow(btn) {
  const row = btn.closest("tr");
  [...row.cells].forEach((cell, i) => {
    if (i < 11) {
      const input = cell.querySelector("input");
      if (input) cell.textContent = input.value;
    }
  });
}

function deleteRow(btn) {
  btn.closest("tr").remove();
}
</script>
</body>
</html>
